<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SettleUp - Split Bills in USDC</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8fafc;
      color: #111827;
      padding: 20px;
    }
    h1 {
      color: #2563eb;
      text-align: center;
    }
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 20px auto;
      max-width: 600px;
    }
    input, button, select {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
    }
    button {
      background: #2563eb;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #1d4ed8;
    }
  </style>
</head>
<body>
  <h1>ðŸ’¸ SettleUp - Split Bills in USDC</h1>
  <div class="card">
    <button id="connectWallet">Connect Wallet</button>
    <p id="walletAddress"></p>

    <h3>Add Expense</h3>
    <input type="number" id="groupId" placeholder="Group ID" />
    <input type="text" id="description" placeholder="Description" />
    <input type="number" id="amount" placeholder="Amount (in USDC smallest unit)" />

    <label for="payer">Payer (Auto-filled)</label>
    <input type="text" id="payer" readonly />

    <button id="addExpense">Add Expense</button>
  </div>

  <script>
    const contractAddress = "0xdfA5b290290762bb84082Da7Fd7cEc94fbe97E54";
    const contractABI = [
     [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "usdcAddress",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "payer",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address[]",
				"name": "participants",
				"type": "address[]"
			}
		],
		"name": "ExpenseAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "member",
				"type": "address"
			}
		],
		"name": "MemberAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "PotWithdrawn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Settled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "finalizer",
				"type": "address"
			}
		],
		"name": "TripFinalized",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "MAX_MEMBERS",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "USDC",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "payer",
				"type": "address"
			},
			{
				"internalType": "address[]",
				"name": "participants",
				"type": "address[]"
			}
		],
		"name": "addExpense",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "creator",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "finalizeTrip",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "finalized",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getFinalSummary",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "who",
				"type": "address[]"
			},
			{
				"internalType": "int256[]",
				"name": "netAmount",
				"type": "int256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getMyBalances",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "creditors",
				"type": "address[]"
			},
			{
				"internalType": "int256[]",
				"name": "amounts",
				"type": "int256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "members",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "creditor",
				"type": "address"
			}
		],
		"name": "settle",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawPot",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	}
]
      {
        "inputs": [
          { "internalType": "uint256", "name": "groupId", "type": "uint256" },
          { "internalType": "string", "name": "description", "type": "string" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "internalType": "address", "name": "payer", "type": "address" }
        ],
        "name": "addExpense",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let provider;
    let signer;
    let contract;
    let signerAddress;

    async function connectWallet() {
      if (typeof window.ethereum !== "undefined") {
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          signerAddress = await signer.getAddress();
          contract = new ethers.Contract(contractAddress, contractABI, signer);

          document.getElementById("walletAddress").innerText = `Connected: ${signerAddress}`;
          document.getElementById("payer").value = signerAddress;
        } catch (err) {
          alert("Failed to connect wallet: " + err.message);
        }
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function addExpense() {
      const groupId = document.getElementById("groupId").value;
      const description = document.getElementById("description").value;
      const amount = document.getElementById("amount").value;

      if (!groupId || !description || !amount) {
        alert("Please fill all fields.");
        return;
      }

      try {
        const tx = await contract.addExpense(groupId, description, amount, signerAddress);
        alert("Transaction sent! Hash: " + tx.hash);
        await tx.wait();
        alert("Expense added successfully!");
      } catch (err) {
        console.error(err);
        alert("Transaction failed: " + (err.data?.message || err.message));
      }
    }

    document.getElementById("connectWallet").onclick = connectWallet;
    document.getElementById("addExpense").onclick = addExpense;
  </script>
</body>
</html>
